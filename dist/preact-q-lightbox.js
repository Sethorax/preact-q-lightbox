function t(t){return t&&"object"==typeof t&&"default"in t?t.default:t}var n=t(require("unistore")),e=require("preact"),i=t(e),o=require("unistore/preact"),r=n({items:[],currentItem:0,isVisible:!1,isLoading:!1,isTransitioning:!1,canNavigate:!0}),s=["src"],a=function(t){if("object"!=typeof t)return!1;switch(t.type){case"image":return n=s,e=Object.keys(t),n.every(function(t){return e.indexOf(t)>-1})}var n,e;return!1};function c(t){return{setItems:function(t,n){return{items:n}},setCurrentItem:function(t,n){return{currentItem:n}},showLightbox:function(){return{isVisible:!0}},hideLightbox:function(){return{isVisible:!1}},setTransitionState:function(t,n){return{isTransitioning:n}},setCanNavigate:function(t,n){return{canNavigate:n}},setLoadingState:function(t,n){return{isLoading:n}}}}var p=function(t){function n(){t.call(this),this.state={currentContent:null,nextContent:null,mediumMaxWidth:0,mediumMaxHeight:0,maxContentBoxWidth:0,contentBoxHeightRatio:0}}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.componentWillMount=function(){this.loadingWarmupTimer=null,this.contentInnerRef=null,this.maxPossibleContentHeight=0},n.prototype.componentDidMount=function(){var t,n=this;this.renderItem(),window.addEventListener("resize",function(){return requestAnimationFrame(function(){clearTimeout(t),t=setTimeout(function(){n.setState(n.calculateContentBoxDimensions())},100)})})},n.prototype.componentDidUpdate=function(t){t.item!==this.props.item&&this.renderItem()},n.prototype.setContent=function(t,n,e){var i=this;clearTimeout(this.loadingWarmupTimer),this.props.setLoadingState(!1),this.props.setTransitionState(!0),this.setState(Object.assign({nextContent:t,mediumMaxWidth:n,mediumMaxHeight:e},this.calculateContentBoxDimensions.bind(this)(n,e))),setTimeout(function(){i.setState({currentContent:t,isTransitioning:!1}),i.props.setTransitionState(!1),i.props.setCanNavigate(!0)},this.props.transitionDuration)},n.prototype.calculateContentBoxDimensions=function(t,n){void 0===t&&(t=this.state.mediumMaxWidth),void 0===n&&(n=this.state.mediumMaxHeight);var e=t*this.contentInnerRef.clientHeight/n;return{contentBoxHeightRatio:100*n/t,maxContentBoxWidth:t>e?e:t}},n.prototype.handleContentInnerRef=function(t){t&&(this.contentInnerRef=t)},n.prototype.handleOuterContentClick=function(){this.props.hideLightbox()},n.prototype.handleInnerContentClick=function(t){t.stopPropagation()},n.prototype.startLoadingWarmupTimer=function(){var t=this;this.loadingWarmupTimer=setTimeout(function(){t.props.setLoadingState(!0)},100)},n.prototype.renderItem=function(){var t=this;this.startLoadingWarmupTimer(),new Promise(function(n){switch(t.props.item.type){case"image":t.renderImage().then(n)}}).then(function(n){return t.setContent(n.content,n.width,n.height)})},n.prototype.renderImage=function(){var t=this;return new Promise(function(n){var i=new Image;i.onload=function(){n({content:e.h("img",{className:"q-lightbox-content__media q-lightbox-content__media_image",src:t.props.item.src}),width:i.width,height:i.height})},i.src=t.props.item.src})},n.prototype.render=function(){return e.h("div",{onClick:this.handleOuterContentClick.bind(this),className:"q-lightbox-content"},e.h("div",{ref:this.handleContentInnerRef.bind(this),className:"q-lightbox-content__inner"},e.h("div",{onClick:this.handleInnerContentClick.bind(this),className:"q-lightbox-content__sizer",style:{maxWidth:this.state.maxContentBoxWidth,transitionDuration:this.props.transitionDuration+"ms"}},e.h("div",{className:"q-lightbox-content__holder",style:{width:"100%",paddingBottom:this.state.contentBoxHeightRatio+"%",transitionDuration:this.props.transitionDuration+"ms"}},e.h("div",{className:"q-lightbox-content__media-holder"},this.state.nextContent),e.h("div",{className:"q-lightbox-content__media-holder",style:{transitionDuration:this.props.isTransitioning?this.props.transitionDuration+"ms":"0ms",opacity:this.props.isTransitioning?"0":"1"}},this.state.currentContent)))))},n}(i.Component),h=o.connect(["isVisible","isTransitioning"],c)(p),u=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.render=function(){return e.h("div",{class:"q-lightbox-arrows"},e.h("div",{onClick:this.props.onPrevClick,className:"q-lightbox-arrows__arrow q-lightbox-arrows__arrow_prev"}),e.h("div",{onClick:this.props.onNextClick,className:"q-lightbox-arrows__arrow q-lightbox-arrows__arrow_next"}))},n}(i.Component),l=o.connect([])(u),d=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.handleClick=function(){this.props.hideLightbox()},n.prototype.render=function(){return e.h("div",{onClick:this.handleClick.bind(this),class:"q-lightbox-close-button"})},n}(i.Component),m=o.connect([],c)(d),g=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.render=function(){var t=["q-lightbox-loading-bar"];return this.props.isLoading&&t.push("q-lightbox-loading-bar_is-active"),e.h("div",{class:t.join(" ")},e.h("div",{className:"q-lightbox-loading-bar__indeterminate"}))},n}(i.Component),f=o.connect(["isLoading"],c)(g),b=function(t){function n(){t.apply(this,arguments)}return t&&(n.__proto__=t),(n.prototype=Object.create(t&&t.prototype)).constructor=n,n.prototype.canNavigate=function(){return this.props.canNavigate&&!1===this.props.isTransitioning},n.prototype.gotoItem=function(t){this.props.setCanNavigate(!1),this.props.setCurrentItem(t)},n.prototype.gotoNext=function(){this.canNavigate()&&this.gotoItem(this.props.currentItem<this.props.items.length-1?this.props.currentItem+1:0)},n.prototype.gotoPrev=function(){this.canNavigate()&&this.gotoItem(this.props.currentItem>0?this.props.currentItem-1:this.props.items.length-1)},n.prototype.render=function(){return e.h("div",{class:"q-lightbox",style:this.props.isVisible?{opacity:1,pointerEvents:"all"}:{opacity:0,pointerEvents:"none"}},e.h(h,{item:this.props.items[this.props.currentItem],transitionDuration:this.props.transitionDuration}),e.h(f,null),this.props.showArrows&&e.h(l,{onNextClick:this.gotoNext.bind(this),onPrevClick:this.gotoPrev.bind(this)}),e.h(m,null))},n}(i.Component);b.defaultProps={showArrows:!0,transitionDuration:500};var x,v=o.connect(["currentItem","isVisible","isTransitioning","canNavigate"],c)(b),y=function(){return{defaultProps:{},render:function(t,n){if(void 0===n&&(n=0),!function(t){return!(!t||0===t.length)&&t.every(function(t){return a(t)})}(t))return console.warn("[QLightbox] Invalid item structure!");var s=Object.assign(this.defaultProps,{items:t});r.setState({currentItem:n}),i.render(e.h(o.Provider,{store:r},e.h(v,s)),null,(x||(x=document.createElement("div"),document.body.appendChild(x)),x)),r.setState({isVisible:!0})},setDefaultProps:function(t){this.defaultProps=Object.assign(this.defaultProps,t)}}},_=null;exports.displayLightbox=function(t,n){_||(_=y()),_.render(t,n)},exports.configureLightbox=function(t){_||(_=y()),_.setDefaultProps(t)};
